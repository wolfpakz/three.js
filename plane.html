<!doctype html>
<html lang="en">
  <head>
    <title>Show me a plane, damnit!!</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <style>
      body {
        font-family: Monospace;
        background-color: #f0f0f0;
        margin: 0px;
        overflow: hidden;
      }
    </style>
  </head>

  <body>
  </body>

  <script language="javascript" type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>

  <script src="examples/js/Detector.js"></script>
  <script src="examples/js/Stats.js"></script>
  <script src="build/Three.js"></script>

  <script>
    var camera, scene, renderer, container, projector, board;

    if (!Detector.webgl) Detector.addGetWebGLMessage();

    init();
    animate();

    function init() {
      container = document.createElement( 'div' );
      document.body.appendChild( container );

      // create a camera and scene
      camera = new THREE.PerspectiveCamera( 45, window.innerWidth / window.innerHeight, 1, 10000 );
      camera.position.set( 0, 90, 160 );
      camera.target = new THREE.Vector3( 0, 150, 0 );

      scene  = new THREE.Scene();
      scene.add(camera);

      addBoard(scene);

      var sphere = createSphere(1, 32, 16)
      sphere.position.y = 1
      scene.add(sphere)

      // create a point light
      var pointLight = new THREE.PointLight(0xFFFFFF, 1.5);

      // set its position
      pointLight.position.x = 0;
      pointLight.position.y = 100;
      pointLight.position.z = 0;

      // add to the scene
      scene.add(pointLight);

      projector = new THREE.Projector();

      // create a WebGL renderer
      renderer = new THREE.WebGLRenderer();

      // start the renderer
      renderer.setSize(window.innerWidth, window.innerHeight);
      container.appendChild(renderer.domElement);

      // listen for clicks
      document.addEventListener( 'mousedown', onDocumentMouseDown, false );
    }

    function onDocumentMouseDown(event) {
      event.preventDefault();

      var vector = new THREE.Vector3(( event.clientX / window.innerWidth ) * 2 - 1, -( event.clientY / window.innerHeight ) * 2 + 1, 0.5);
      projector.unprojectVector(vector, camera);

      var ray        = new THREE.Ray(camera.position, vector.subSelf(camera.position).normalize());
      var intersects = ray.intersectObjects([board]);

      if (intersects.length > 0) {
        var particle = createSphere(1, 32, 16)

        particle.position = intersects[0].point
        particle.position.y = 1

        scene.add(particle)
      }
    }

    function createSphere(radius, segments, rings) {
      // create the sphere's material
      var sphereMaterial =
        new THREE.MeshLambertMaterial({
          color:0xCC0000
        });

      // create a new mesh with
      // sphere geometry - we will cover
      // the sphereMaterial next!
      return new THREE.Mesh(

        new THREE.SphereGeometry(
          radius,
          segments,
          rings),

        sphereMaterial);
    }

    function animate() {
      requestAnimationFrame(animate);
      render();
    }

    function render() {
      camera.lookAt(scene.position)
      renderer.render(scene, camera);
    }

    function addBoard(scene) {
      // create the board's material
      var material = new THREE.MeshLambertMaterial({
        color:0xFFFFFF
      });

      // create the board
      var boardWidth = 160, boardDepth = 160;
      var geometry   = new THREE.PlaneGeometry(boardWidth, boardDepth, 10, 10);
      board          = new THREE.Mesh(geometry, material);

      scene.add(board);
    }

  </script>
</html>
